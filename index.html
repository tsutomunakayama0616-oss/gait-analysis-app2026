<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>æ­©è¡Œè§£æã‚¢ãƒ—ãƒª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("service-worker.js");
      });
    }
  </script>

  <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- jsPDFï¼ˆPDFç”Ÿæˆï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆï¼ˆPDFç”¨ï¼‰ -->
  <script src="pdf-font.js"></script>

  <!-- MediaPipe PoseLandmarker -->
  <script type="module">
    import {
      PoseLandmarker,
      FilesetResolver,
      DrawingUtils
    } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0";

    window.PoseLandmarker = PoseLandmarker;
    window.FilesetResolver = FilesetResolver;
    window.DrawingUtils = DrawingUtils;
  </script>

  <!-- iOSé¢¨ãƒ‡ã‚¶ã‚¤ãƒ³ -->
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Noto Sans JP", sans-serif;
      background: #f2f2f7;
      color: #1c1c1e;
    }
    header {
      text-align: center;
      padding: 20px 10px;
      background: white;
      border-bottom: 1px solid #e5e5ea;
    }
    .title {
      font-size: 22px;
      font-weight: 700;
      color: #111;
    }
    .subtitle {
      font-size: 14px;
      margin-top: 4px;
      color: #666;
    }
    .container {
      width: 100%;
      max-width: 480px;
      margin: auto;
      padding: 14px;
    }

    /* 2æ®µUI */
    .mode-switch-top {
      margin-bottom: 8px;
    }
    .mode-switch {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
    .mode-button {
      flex: 1;
      padding: 12px;
      font-size: 15px;
      border-radius: 10px;
      border: none;
      background: #e5e5ea;
      color: #333;
      font-weight: 600;
    }
    .mode-button.active {
      background: #007aff;
      color: white;
    }

    .section { display: none; }
    .section.active { display: block; }

    .card {
      background: white;
      padding: 16px;
      border-radius: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      margin-bottom: 16px;
      position: relative;
    }

    /* RECè¡¨ç¤º */
    #recIndicator {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 6px 10px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
      display: none;
    }

    /* å¤§ããªãƒœã‚¿ãƒ³ */
    .big-button {
      width: 100%;
      padding: 16px;
      margin-top: 12px;
      font-size: 18px;
      font-weight: 700;
      border-radius: 12px;
      border: none;
      background: #007aff;
      color: white;
      box-shadow: 0 4px 10px rgba(0,122,255,0.4);
    }
    .big-button:disabled {
      background: #b0c9ff;
      box-shadow: none;
    }
    .stop-button {
      width: 100%;
      padding: 16px;
      margin-top: 12px;
      font-size: 18px;
      font-weight: 700;
      border-radius: 12px;
      border: none;
      background: #ff3b30;
      color: white;
      box-shadow: 0 4px 10px rgba(255,59,48,0.4);
    }

    /* iOSã‚«ãƒ¼ãƒ‰ */
    .result-box {
      background: white;
      padding: 16px;
      border-radius: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      margin-top: 20px;
      font-size: 15px;
    }

    video, canvas {
      width: 100%;
      border-radius: 12px;
      margin-top: 12px;
    }

    .primary-button {
      width: 100%;
      padding: 14px;
      margin-top: 12px;
      border-radius: 12px;
      border: none;
      background: #007aff;
      color: #fff;
      font-size: 16px;
      font-weight: 700;
      box-shadow: 0 4px 10px rgba(0,122,255,0.4);
    }

    .ios-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .ios-table th, .ios-table td {
      padding: 10px;
      border-bottom: 1px solid #e5e5ea;
      text-align: left;
    }
    .ios-table th {
      background: #f9f9fb;
      font-weight: 600;
    }
  </style>
</head>

<body>
<header>
  <div class="title">æ­©è¡Œè§£æã‚¢ãƒ—ãƒª</div>
  <div class="subtitle">ä»Šæ—¥ã®æ­©ãæ–¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¾ã—ã‚‡ã†</div>
</header>

<div class="container">

  <!-- ä¸Šæ®µï¼šä½¿ç”¨æ–¹æ³• -->
  <div class="mode-switch-top">
    <button id="usageModeBtn" class="mode-button active">ğŸ“˜ ã‚¢ãƒ—ãƒªã®ä½¿ç”¨æ–¹æ³•</button>
  </div>

  <!-- ä¸‹æ®µï¼šæ’®å½±è£œåŠ©ï¼‹å‹•ä½œè§£æ -->
  <div class="mode-switch">
    <button id="liveModeBtn" class="mode-button">ğŸ“¸ æ’®å½±è£œåŠ©</button>
    <button id="videoModeBtn" class="mode-button">ğŸ¥ å‹•ä½œè§£æ</button>
  </div>

  <!-- ä½¿ç”¨æ–¹æ³• -->
  <section id="usageSection" class="section active">
    <div class="card">
      <h2>ğŸ“˜ ã‚¢ãƒ—ãƒªã®ä½¿ç”¨æ–¹æ³•</h2>

      <div class="result-box">
        <h3>ã‚¢ãƒ—ãƒªã®ç›®çš„</h3>
        <p>å¾Œã‚ã‹ã‚‰æ’®å½±ã—ãŸæ­©è¡Œå‹•ç”»ã‚’ã‚‚ã¨ã«ã€éª¨ç›¤ã®å‚¾ããƒ»è¶³ã®å‹•ããƒ»å·¦å³ã®ãƒãƒ©ãƒ³ã‚¹ãƒ»æ­©ãé€Ÿã•ãªã©ã‚’æ¨å®šã—ã€æ­©ãæ–¹ã®ç‰¹å¾´ã‚’ã‚ã‹ã‚Šã‚„ã™ãè¦‹ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</p>
      </div>

      <div class="result-box">
        <h3>æ’®å½±ç’°å¢ƒã®ãƒã‚¤ãƒ³ãƒˆ</h3>
        <ul>
          <li>æ­©è¡Œè·¯ã¯ <strong>5ã€œ8ãƒ¡ãƒ¼ãƒˆãƒ«</strong></li>
          <li>æ˜ã‚‹ã„å ´æ‰€ã§æ’®å½±ï¼ˆé€†å…‰ã¯é¿ã‘ã‚‹ï¼‰</li>
          <li>èƒŒæ™¯ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ï¼ˆäººãŒæ¨ªåˆ‡ã‚‰ãªã„ï¼‰</li>
        </ul>
      </div>

      <div class="result-box">
        <h3>ã‚«ãƒ¡ãƒ©ä½ç½®</h3>
        <ul>
          <li><strong>ã‹ã‚‰ã ã®çœŸå¾Œã‚</strong>ã‹ã‚‰æ’®å½±</li>
          <li>ã‚«ãƒ¡ãƒ©ã®é«˜ã•ã¯ <strong>è…°ã€œèƒ¸ã®é«˜ã•ï¼ˆ90ã€œ120cmï¼‰</strong></li>
          <li>ã‹ã‚‰ã ã¨ã®è·é›¢ã¯ <strong>3ã€œ5ãƒ¡ãƒ¼ãƒˆãƒ«</strong></li>
        </ul>
      </div>

      <div class="result-box">
        <h3>æœè£…</h3>
        <ul>
          <li>è†ã‚„è‚¡é–¢ç¯€ã®å‹•ããŒè¦‹ãˆã‚‹æœè£…</li>
          <li>ã‚¹ã‚«ãƒ¼ãƒˆãƒ»é•·ã„ã‚³ãƒ¼ãƒˆã¯é¿ã‘ã‚‹</li>
        </ul>
      </div>

      <div class="result-box">
        <h3>æ’®å½±æ‰‹é †</h3>
        <ol>
          <li>æ­©è¡Œè·¯ã®ç«¯ã«ç«‹ã£ã¦ã‚‚ã‚‰ã†</li>
          <li>ã‚«ãƒ¡ãƒ©ã‚’å¾Œã‚ã‹ã‚‰æ§‹ãˆã‚‹</li>
          <li>æ­©ãå§‹ã‚ãŸã‚‰éŒ²ç”»é–‹å§‹</li>
          <li>æ­©è¡Œã®ä¸­å¤®ã€œçµ‚ã‚ã‚Šã¾ã§æ’®å½±</li>
        </ol>
      </div>

      <div class="result-box">
        <h3>ã‚ˆãã‚ã‚‹å¤±æ•—ã¨å¯¾ç­–</h3>
        <ul>
          <li>å…¨èº«ãŒæ˜ ã‚‰ãªã„ â†’ ã‚«ãƒ¡ãƒ©ã‚’å°‘ã—é›¢ã™</li>
          <li>é€†å…‰ã§æš—ã„ â†’ ã‚«ãƒ¡ãƒ©ã®å‘ãã‚’å¤‰ãˆã‚‹</li>
          <li>æ–œã‚å¾Œã‚ã‹ã‚‰æ’®å½± â†’ çœŸå¾Œã‚ã«ç«‹ã¤</li>
        </ul>
      </div>

      <div class="result-box">
        <h3>æ³¨æ„ç‚¹</h3>
        <p>ã“ã®ã‚¢ãƒ—ãƒªã¯è¨ºæ–­ã‚’è¡Œã†ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ­©ãæ–¹ã®å¤‰åŒ–ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®å‚è€ƒæƒ…å ±ã¨ã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>
      </div>
    </div>
  </section>

  <!-- æ’®å½±è£œåŠ© -->
  <section id="liveSection" class="section">
    <div class="card">
      <h2>ğŸ“¸ æ’®å½±è£œåŠ©ãƒ¢ãƒ¼ãƒ‰</h2>

      <div id="recIndicator">â— REC</div>

      <div class="result-box">
        <p>æ’®å½±å‰ã«ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
        <ul>
          <li><label><input type="checkbox" class="precheck"> å¾Œã‚ã‹ã‚‰æ’®å½±ã—ã¦ã„ã‚‹</label></li>
          <li><label><input type="checkbox" class="precheck"> å…¨èº«ãŒç”»é¢ã«å…¥ã£ã¦ã„ã‚‹</label></li>
          <li><label><input type="checkbox" class="precheck"> æ™®æ®µã©ãŠã‚Šã®é€Ÿã•ã§æ­©ã„ã¦ã„ã‚‹</label></li>
        </ul>
      </div>

      <video id="liveVideo" playsinline muted></video>
      <canvas id="liveCanvas"></canvas>

      <button id="startLiveBtn" class="big-button" disabled>æ’®å½±é–‹å§‹</button>
      <button id="stopLiveBtn" class="stop-button">ã‚«ãƒ¡ãƒ©åœæ­¢</button>

      <div id="liveStatus"></div>
      <div id="liveError" style="color:red;"></div>
    </div>
  </section>

  <!-- å‹•ä½œè§£æ -->
  <section id="videoSection" class="section">
    <div class="card">
      <h2>ğŸ¥ å‹•ä½œè§£æãƒ¢ãƒ¼ãƒ‰</h2>

      <label>æ‰‹è¡“æ—¥ï¼š</label>
      <input type="date" id="surgeryDate" style="width:100%; margin-top:6px;">
      <div id="surgeryDiffText" style="margin-top:6px; color:#555;"></div>

      <input type="file" id="videoFileInput" accept="video/*" style="margin-top:12px;">

      <button id="analyzeVideoBtn" class="primary-button">å‹•ä½œã‚’è§£æã™ã‚‹</button>

      <video id="analysisVideo" controls playsinline muted></video>
      <canvas id="analysisCanvas"></canvas>

      <div id="videoStatus"></div>
      <div id="videoError" style="color:red;"></div>

      <!-- è§£æçµæœ -->
      <div id="resultBox" class="result-box" style="display:none;">
        <h3>â‘  æ­©ãæ–¹ã®çµæœï¼ˆå·¦å³åˆ¥ï¼‰</h3>
        <div id="pelvisResult"></div>
        <div id="hipAbductionResult"></div>
        <div id="hipAdductionResult"></div>
        <div id="speedResult"></div>
        <div id="symmetryResult"></div>
      </div>

      <!-- æ­©è¡Œã‚¿ã‚¤ãƒ—è¨ºæ–­ -->
      <div id="typeBox" class="result-box" style="display:none;">
        <h3>â‘¡ ã‚ãªãŸã®æ­©ãæ–¹ã®ç‰¹å¾´</h3>
        <div id="typeContent"></div>
      </div>

      <!-- ãŠã™ã™ã‚ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º -->
      <div id="exerciseBox" class="result-box" style="display:none;">
        <h3>â‘¢ ã‚ãªãŸã«ãŠã™ã™ã‚ã®ã‚»ãƒ«ãƒ•ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º</h3>
        <div id="exerciseContent"></div>
      </div>

      <!-- PDFãƒ¬ãƒãƒ¼ãƒˆä½œæˆãƒœã‚¿ãƒ³ -->
      <button id="pdfReportBtn" class="primary-button" style="margin-top:12px;">
        PDFãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆ
      </button>

      <h3 style="margin-top:20px;">å›å¾©ã®å¤‰åŒ–ã‚’æ¯”ã¹ã‚‹</h3>
      <table id="resultTable" class="ios-table">
        <thead>
          <tr>
            <th>æ¡ä»¶</th>
            <th>éª¨ç›¤å‚¾ã</th>
            <th>å¤–è»¢</th>
            <th>å†…è»¢</th>
            <th>é€Ÿåº¦ï¼ˆ%ï¼‰</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <canvas id="compareChart" style="margin-top:16px;"></canvas>
    </div>
  </section>

</div>

<script src="script.js"></script>
</body>

</html>
